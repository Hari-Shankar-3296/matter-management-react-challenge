import{j as e}from"./vendor-query-30WTYxUa.js";import{h as P,r as h}from"./vendor-react-3BJtw-ek.js";import{b as J,c as K,d as Q,e as V}from"./useTickets-D2PJlkea.js";import{u as X}from"./useUsers-vmEtP205.js";import{T as d}from"./index-XP9HmkET.js";import{i as M,a as k,B as j,f as N,A as O,M as Z,T as _,C as w}from"./Badge-aCoWILHI.js";import"./queryKeys-D-dtdCA2.js";const F=({onFilterChange:s,initialFilters:a})=>{const[n,m]=P(),[i,p]=h.useState(n.get("search")||(a==null?void 0:a.search)||""),o=n.get("status")||(a==null?void 0:a.status)||"",l=n.get("priority")||"",v=n.get("sortBy")||(a==null?void 0:a.sortBy)||"date",u=n.get("dueThisWeek")==="true";h.useEffect(()=>{const t=setTimeout(()=>{const r=new URLSearchParams(n);i?r.set("search",i):r.delete("search"),m(r),s({search:i,status:o,priority:l,sortBy:v,dueThisWeek:u})},300);return()=>clearTimeout(t)},[i,o,l,v,u,m,s,n]);const x=(t,r)=>{const g=new URLSearchParams(n);r?g.set(t,r.toString()):g.delete(t),m(g),s({search:i,status:t==="status"?r:o,priority:t==="priority"?r:l,sortBy:t==="sortBy"?r:v,dueThisWeek:t==="dueThisWeek"?r:u})};return e.jsxs("div",{className:"ticket-filters",children:[e.jsx("input",{type:"text",placeholder:`Search ${d.items}...`,value:i,onChange:t=>p(t.target.value)}),e.jsxs("select",{value:o,onChange:t=>x("status",t.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"closed",children:"Closed"})]}),e.jsxs("select",{value:l,onChange:t=>x("priority",t.target.value),children:[e.jsx("option",{value:"",children:"All Priority"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsxs("select",{value:v,onChange:t=>x("sortBy",t.target.value),children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"title",children:"Sort by Title"}),e.jsx("option",{value:"priority",children:"Sort by Priority"}),e.jsx("option",{value:"dueDate",children:"Sort by Due Date"})]}),e.jsxs("div",{className:"filter-checkbox",children:[e.jsx("input",{type:"checkbox",id:"dueThisWeek",checked:u,onChange:t=>x("dueThisWeek",t.target.checked)}),e.jsx("label",{htmlFor:"dueThisWeek",style:{marginLeft:"10px"},children:"Due this week"})]})]})},ee=({ticket:s,isSelected:a,onSelect:n,onEdit:m,onDelete:i})=>{const p=M(s.dueDate),o=k(s.dueDate);return e.jsxs("div",{className:`ticket-card ${a?"selected":""}`,onClick:()=>n(s),children:[e.jsxs("div",{className:"ticket-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flex:1,minWidth:0},children:[e.jsx("span",{className:"ticket-card-title",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.title}),p&&!o&&e.jsx(j,{type:"due",value:"Due this week"}),o&&e.jsx(j,{type:"due",value:"Overdue"})]}),e.jsxs("div",{className:"ticket-card-actions",children:[e.jsx("button",{className:"action-btn",onClick:l=>{l.stopPropagation(),m(s)},children:"âœï¸"}),e.jsx("button",{className:"action-btn delete",onClick:l=>{l.stopPropagation(),i(s.id)},children:"ðŸ—‘ï¸"})]})]}),e.jsx("div",{className:"ticket-card-meta",children:e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",position:"relative"},children:[e.jsx(j,{type:"status",value:s.status}),e.jsx(j,{type:"priority",value:s.priority}),e.jsx("span",{className:"ticket-card-date",children:N(s.createdAt)}),e.jsxs("div",{style:{position:"absolute",right:"8px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("p",{className:"ticket-card-date",children:"Assigned to "}),e.jsx("div",{onClick:l=>l.stopPropagation(),children:e.jsx(O,{ticketId:s.id,currentAssigneeId:s.assigneeId})})]})]})})]})},se=({tickets:s,selectedId:a,onSelect:n,onEdit:m,onDelete:i})=>!s||s.length===0?e.jsxs("div",{className:"empty-state",children:["No ",d.items," found"]}):e.jsx("div",{className:"ticket-list",style:{maxHeight:"65vh",overflowY:"auto"},children:s.map(p=>e.jsx(ee,{ticket:p,isSelected:a===p.id,onSelect:n,onEdit:m,onDelete:i},p.id))}),te=({ticket:s,getUserName:a})=>s?e.jsxs("div",{className:"ticket-detail",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsx("h2",{children:s.title})}),e.jsxs("div",{className:"ticket-meta",children:[e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"ID"}),e.jsxs("span",{children:["#",s.id]})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Status"}),e.jsx(j,{type:"status",value:s.status})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Priority"}),e.jsx(j,{type:"priority",value:s.priority})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Reporter"}),e.jsx("span",{children:a(s.reporterId)})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Assignee"}),e.jsx(O,{ticketId:s.id,currentAssigneeId:s.assigneeId})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Created"}),e.jsx("span",{children:N(s.createdAt)})]}),s.dueDate&&e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Due Date"}),e.jsxs("span",{children:[N(s.dueDate),M(s.dueDate)&&!k(s.dueDate)&&e.jsx(j,{type:"due",value:"Due this week"}),k(s.dueDate)&&e.jsx(j,{type:"due",value:"Overdue"})]})]})]}),e.jsxs("div",{className:"ticket-description",children:[e.jsx("h3",{children:"Description"}),e.jsx("p",{children:s.description||"No description provided."})]})]}):e.jsxs("div",{className:"ticket-detail-empty",children:["Select a ",d.item," to view details"]}),oe=()=>{const[s]=P(),[a,n]=h.useState(null),[m,i]=h.useState(!1),[p,o]=h.useState(!1),[l,v]=h.useState(null),[u,x]=h.useState(null),[t,r]=h.useState(!1),[g,D]=h.useState(null),S={search:s.get("search")||void 0,status:s.get("status")||void 0,priority:s.get("priority")||void 0,sortBy:s.get("sortBy")||"date",dueThisWeek:s.get("dueThisWeek")==="true"},{data:f,isLoading:E,error:A}=J(S),{data:y}=X(),C=K(),U=Q(),b=V(),W=f==null?void 0:f.find(c=>c.id===a),L=c=>{if(!c)return"Unassigned";const T=y==null?void 0:y.find(z=>z.id===c);return T?`${T.firstName} ${T.lastName}`:"Unknown"},B=h.useCallback(()=>{},[]),$=()=>{x(null),i(!0)},R=c=>{x(c),i(!0)},H=c=>{v(c),o(!0)},Y=()=>{l&&(U.mutate(l),a===l&&n(null),v(null))},G=c=>{u?(D(c),r(!0)):b.mutate(c,{onSuccess:()=>{i(!1)}})},q=()=>{u&&g&&C.mutate({id:u.id,...g},{onSuccess:()=>{i(!1),x(null),r(!1),D(null)}})},I=()=>{i(!1),x(null)};return e.jsxs("div",{className:"tickets-page",children:[e.jsxs("div",{className:"ticket-list-section",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:d.ITEMS}),e.jsxs("button",{className:"btn btn-primary",onClick:$,children:["+ Add ",d.ITEM]})]}),e.jsx(F,{onFilterChange:B,initialFilters:S}),E?e.jsxs("div",{className:"loading",children:["Loading ",d.items,"..."]}):A?e.jsxs("div",{className:"error-message",children:["Error loading ",d.items]}):e.jsx(se,{tickets:f||[],selectedId:a,onSelect:c=>n(c.id),onEdit:R,onDelete:H})]}),e.jsx("div",{className:"ticket-detail-section",children:e.jsx(te,{ticket:W,getUserName:L})}),e.jsx(Z,{isOpen:m,onClose:I,title:u?`Edit ${d.ITEM}`:`Create ${d.ITEM}`,children:e.jsx(_,{ticket:u,onSubmit:G,onCancel:I,isLoading:C.isPending||b.isPending})}),e.jsx(w,{isOpen:t,onClose:()=>r(!1),onConfirm:q,title:`Update ${d.ITEM}`,message:`Are you sure you want to update this ${d.item}?`,confirmLabel:"Update"}),e.jsx(w,{isOpen:p,onClose:()=>o(!1),onConfirm:Y,title:`Delete ${d.ITEM}`,message:`Are you sure you want to delete this ${d.item}?
This action cannot be undone.`,confirmLabel:"Delete",isDanger:!0})]})};export{oe as default};
