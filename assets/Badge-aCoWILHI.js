import{j as e}from"./vendor-query-30WTYxUa.js";import{r as p,a as I}from"./vendor-react-3BJtw-ek.js";import{u as S}from"./useUsers-vmEtP205.js";import{u as k,T as y}from"./index-XP9HmkET.js";import{c as z}from"./useTickets-D2PJlkea.js";const R=({isOpen:t,onClose:n,title:c,children:o})=>{const a=p.useRef(null);p.useEffect(()=>{const i=m=>{m.key==="Escape"&&n()};return t&&(document.addEventListener("keydown",i),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",i),document.body.style.overflow="unset"}},[t,n]);const l=i=>{i.target===i.currentTarget&&n()};return t?e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsxs("div",{className:"modal",ref:a,children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:c}),e.jsx("button",{className:"modal-close",onClick:n,"aria-label":"Close modal",children:"×"})]}),e.jsx("div",{className:"modal-content",children:o})]})}):null},P=({isOpen:t,onClose:n,onConfirm:c,title:o,message:a,confirmLabel:l="Confirm",cancelLabel:i="Cancel",isDanger:m=!1})=>e.jsx(R,{isOpen:t,onClose:n,title:o,children:e.jsxs("div",{className:"confirmation-content",style:{padding:"1.5rem"},children:[e.jsx("pre",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)",fontFamily:"inherit",whiteSpace:"pre-wrap",textAlign:"center"},children:a}),e.jsxs("div",{className:"form-actions",style:{display:"flex",justifyContent:"center",marginTop:20,paddingTop:0,borderTop:"none"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:n,children:i}),e.jsx("button",{className:`btn ${m?"btn-danger":"btn-primary"}`,onClick:()=>{c(),n()},children:l})]})]})}),H=t=>{if(!t)return!1;const n=new Date,c=new Date(t),o=new Date(n);o.setDate(n.getDate()-n.getDay()),o.setHours(0,0,0,0);const a=new Date(o);return a.setDate(o.getDate()+6),a.setHours(23,59,59,999),c>=o&&c<=a},U=t=>{if(!t)return!1;const n=new Date,c=new Date(t);return n.setHours(0,0,0,0),c.setHours(0,0,0,0),c<n},B=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),L=t=>t?new Date(t).toISOString().split("T")[0]:"",Y=({ticket:t,onSubmit:n,onCancel:c,isLoading:o})=>{const{user:a}=k(),{data:l}=S(),[i,m]=p.useState(""),[h,g]=p.useState(""),[b,u]=p.useState("open"),[w,x]=p.useState("medium"),[N,r]=p.useState(""),[f,v]=p.useState(""),[d,j]=p.useState({});p.useEffect(()=>{j({}),t?(m(t.title),g(t.description||""),u(t.status),x(t.priority),r(t.assigneeId||""),v(L(t.dueDate))):(m(""),g(""),u("open"),x("medium"),r(""),v(""))},[t]);const C=()=>{const s={};if(i.trim()?i.trim().length<3&&(s.title="Title must be at least 3 characters"):s.title="Title is required",h.length>500&&(s.description=`Description must be less than 500 characters (${h.length}/500)`),f){const D=new Date;D.setHours(0,0,0,0);const $=new Date(f);!t&&$<D&&(s.dueDate="Due date cannot be in the past for new items")}return j(s),Object.keys(s).length===0},E=s=>{s.preventDefault(),C()&&n({title:i.trim(),description:h.trim(),status:b,priority:w,assigneeId:N||void 0,dueDate:f||void 0})},T=()=>{if(t){const s=l==null?void 0:l.find(D=>D.id===t.reporterId);return s?`${s.firstName} ${s.lastName}`:"Unknown"}return a?`${a.firstName} ${a.lastName}`:"You"};return e.jsxs("form",{className:"ticket-form",onSubmit:E,children:[t&&e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[y.ITEM," ID"]}),e.jsx("input",{type:"text",value:`#${t.id}`,disabled:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reporter"}),e.jsx("input",{type:"text",value:T(),disabled:!0})]})]}),t&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Created Date"}),e.jsx("input",{type:"text",value:new Date(t.createdAt).toLocaleString(),disabled:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Title *"}),e.jsx("input",{id:"title",type:"text",value:i,onChange:s=>{m(s.target.value),d.title&&j({...d,title:""})},placeholder:`Enter ${y.item} title`,autoFocus:!0,className:d.title?"input-error":"",style:d.title?{borderColor:"var(--danger)"}:{}}),d.title&&e.jsx("span",{className:"error-message",style:{color:"var(--danger)",fontSize:"0.85rem",marginTop:"4px"},children:d.title})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",value:h,onChange:s=>{g(s.target.value),d.description&&j({...d,description:""})},placeholder:`Enter ${y.item} description`,rows:4,style:d.description?{borderColor:"var(--danger)"}:{}}),d.description&&e.jsx("span",{className:"error-message",style:{color:"var(--danger)",fontSize:"0.85rem",marginTop:"4px"},children:d.description}),e.jsxs("div",{style:{textAlign:"right",fontSize:"0.75rem",color:h.length>500?"var(--danger)":"var(--text-muted)"},children:[h.length,"/500"]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",value:b,onChange:s=>u(s.target.value),children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"priority",children:"Priority"}),e.jsxs("select",{id:"priority",value:w,onChange:s=>x(s.target.value),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"assignee",children:"Assignee"}),e.jsxs("select",{id:"assignee",value:N,onChange:s=>r(s.target.value),children:[e.jsx("option",{value:"",children:"-- Unassigned --"}),l==null?void 0:l.map(s=>e.jsxs("option",{value:s.id,children:[s.firstName," ",s.lastName]},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"dueDate",children:"Due Date"}),e.jsx("input",{id:"dueDate",type:"date",value:f,onChange:s=>{v(s.target.value),d.dueDate&&j({...d,dueDate:""})},style:d.dueDate?{borderColor:"var(--danger)"}:{}}),d.dueDate&&e.jsx("span",{className:"error-message",style:{color:"var(--danger)",fontSize:"0.85rem",marginTop:"4px"},children:d.dueDate})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Saving...":t?`Update ${y.ITEM}`:`Create ${y.ITEM}`})]})]})},q=({ticketId:t,currentAssigneeId:n,readonly:c=!1,onUpdate:o})=>{const{data:a}=S(),l=z(),[i,m]=p.useState(!1),h=p.useRef(null),[g,b]=p.useState({top:0,left:0}),u=a==null?void 0:a.find(r=>r.id===n);p.useEffect(()=>{if(i&&h.current){const r=h.current.getBoundingClientRect();b({top:r.bottom+window.scrollY+4,left:r.left+window.scrollX})}},[i]),p.useEffect(()=>{const r=f=>{if(h.current&&!h.current.contains(f.target)){const v=document.getElementById(`assignee-dropdown-${t}`);if(v&&v.contains(f.target))return;m(!1)}};return i&&(document.addEventListener("mousedown",r),window.addEventListener("resize",()=>m(!1)),window.addEventListener("scroll",()=>m(!1),!0)),()=>{document.removeEventListener("mousedown",r),window.removeEventListener("resize",()=>m(!1)),window.removeEventListener("scroll",()=>m(!1),!0)}},[i,t]);const w=r=>{l.mutate({id:t,assigneeId:r},{onSuccess:()=>{m(!1),o&&o()}})},x=(r,f)=>`${r[0]}${f[0]}`.toUpperCase();if(c)return u?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:"var(--primary-500)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",fontWeight:"bold"},children:x(u.firstName,u.lastName)}),e.jsxs("span",{children:[u.firstName," ",u.lastName]})]}):e.jsx("span",{className:"text-muted",children:"Unassigned"});const N=e.jsxs("div",{id:`assignee-dropdown-${t}`,style:{position:"absolute",top:g.top,left:g.left,background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"var(--shadow-lg)",zIndex:9999,width:"240px",maxHeight:"300px",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px",borderBottom:"1px solid var(--border-color)",fontSize:"0.85rem",fontWeight:"bold",color:"var(--text-secondary)"},children:"Assign to..."}),a==null?void 0:a.map(r=>e.jsxs("div",{onClick:f=>{f.stopPropagation(),w(r.id)},style:{padding:"8px 12px",display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",background:n===r.id?"var(--bg-secondary)":"transparent",transition:"background 0.2s"},className:"dropdown-item hover:bg-slate-50 dark:hover:bg-slate-800",children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"var(--primary-500)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.8rem",fontWeight:"bold"},children:x(r.firstName,r.lastName)}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:500},children:[r.firstName," ",r.lastName]}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.email})]}),n===r.id&&e.jsx("span",{style:{marginLeft:"auto",color:"var(--primary-500)"},children:"✓"})]},r.id))]});return e.jsxs("div",{style:{position:"relative",display:"inline-block"},ref:h,children:[e.jsx("div",{onClick:r=>{r.stopPropagation(),m(!i)},style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},className:"assignee-trigger hover:bg-slate-100 dark:hover:bg-slate-800",title:"Click to assign",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:"var(--primary-500)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",fontWeight:"bold",flexShrink:0},children:x(u.firstName,u.lastName)}),e.jsxs("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"120px"},children:[u.firstName," ",u.lastName]})]}):e.jsx("span",{style:{color:"var(--text-muted)",fontStyle:"italic",fontSize:"0.9rem"},children:"+ Assign"})}),i&&I.createPortal(N,document.body)]})},G=({type:t,value:n,className:c="",style:o})=>{const a=n.toLowerCase().replace(/\s+/g,"-");let l="";return t==="status"?l=`status-badge badge-${a}`:t==="priority"?l=`priority-badge priority-${a}`:t==="due"&&(l=`due-badge ${a}`),e.jsx("span",{className:`${l} ${c}`,style:o,children:n})};export{q as A,G as B,P as C,R as M,Y as T,U as a,B as f,H as i};
