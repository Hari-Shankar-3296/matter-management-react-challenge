import{j as e}from"./vendor-query-30WTYxUa.js";import{r as m}from"./vendor-react-3BJtw-ek.js";import{b as L,c as P,d as B,e as K}from"./useTickets-l-PqA1f4.js";import{i as W,a as F,B as v,f as R,A as z,M as G,T as Y,C as k}from"./Badge-D2-mizKm.js";import{T as i}from"./index-qdssDWYQ.js";import"./queryKeys-D-dtdCA2.js";import"./useUsers-vdCakwpb.js";const q=({ticket:a,onEdit:p,onDelete:o})=>{const d=l=>{l.dataTransfer.setData("ticketId",a.id),l.dataTransfer.effectAllowed="move"},c=W(a.dueDate),n=F(a.dueDate);return e.jsxs("div",{className:`kanban-card ${c&&!n?"due-this-week":""} ${n?"overdue":""}`,draggable:!0,onDragStart:d,children:[e.jsxs("div",{className:"kanban-card-header",children:[e.jsxs("span",{className:"kanban-card-id",children:["#",a.id]}),e.jsxs("div",{className:"kanban-card-actions",children:[e.jsx("button",{className:"card-action-btn edit",onClick:()=>p(a),"aria-label":"Edit matter",children:"âœï¸"}),e.jsx("button",{className:"card-action-btn delete",onClick:()=>o(a.id),"aria-label":"Delete matter",children:"ðŸ—‘ï¸"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("h4",{className:"kanban-card-title",style:{margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:c?"140px":"100%"},title:a.title,children:a.title}),c&&!n&&e.jsx(v,{type:"due",value:"Due this week",style:{fontSize:"0.65rem"}})]}),n&&e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx(v,{type:"due",value:"Overdue"})}),a.description&&e.jsx("p",{className:"kanban-card-description",children:a.description}),e.jsxs("div",{className:"kanban-card-meta",children:[e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx(v,{type:"priority",value:a.priority}),a.dueDate&&e.jsx("span",{className:"kanban-card-date",children:R(a.dueDate)})]}),e.jsx("div",{onClick:l=>l.stopPropagation(),children:e.jsx(z,{ticketId:a.id,currentAssigneeId:a.assigneeId,onUpdate:()=>{}})})]})]})},H=({status:a,title:p,tickets:o,onDrop:d,onEdit:c,onDelete:n})=>{const[l,r]=m.useState(!1),b=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",r(!0)},h=()=>{r(!1)},f=s=>{s.preventDefault(),r(!1);const u=s.dataTransfer.getData("ticketId");u&&d(u,a)},x={open:"#3b82f6","in-progress":"#f59e0b",closed:"#10b981"};return e.jsxs("div",{className:`kanban-column ${l?"drag-over":""}`,onDragOver:b,onDragLeave:h,onDrop:f,children:[e.jsxs("div",{className:"kanban-column-header",style:{borderTopColor:x[a]},children:[e.jsx("h3",{className:"kanban-column-title",children:p}),e.jsx("span",{className:"kanban-column-count",children:o.length})]}),e.jsxs("div",{className:"kanban-column-body",children:[o.map(s=>e.jsx(q,{ticket:s,onEdit:c,onDelete:n},s.id)),o.length===0&&e.jsx("div",{className:"kanban-empty",children:"No matters"})]})]})},ae=()=>{const{data:a,isLoading:p,error:o}=L(),d=P(),c=B(),n=K(),[l,r]=m.useState(!1),[b,h]=m.useState(!1),[f,x]=m.useState(null),[s,u]=m.useState(null),[y,j]=m.useState(!1),[D,T]=m.useState(null),O=[{status:"open",title:"Open"},{status:"in-progress",title:"In Progress"},{status:"closed",title:"Closed"}],I=(t,g)=>{const C=a==null?void 0:a.find(A=>A.id===t);C&&C.status!==g&&d.mutate({id:t,status:g})},E=t=>{u(t),r(!0)},S=t=>{x(t),h(!0)},M=()=>{f&&(c.mutate(f),x(null))},w=()=>{u(null),r(!0)},U=t=>{s?(T(t),j(!0)):n.mutate(t,{onSuccess:()=>{r(!1)}})},$=()=>{s&&D&&d.mutate({id:s.id,...D},{onSuccess:()=>{r(!1),u(null),j(!1),T(null)}})},N=()=>{r(!1),u(null)};return p?e.jsxs("div",{className:"loading",children:["Loading ",i.items,"..."]}):o?e.jsxs("div",{className:"error-message",children:["Error loading ",i.items]}):e.jsxs("div",{className:"kanban-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Kanban Board"}),e.jsxs("button",{className:"btn btn-primary",onClick:w,children:["+ Add ",i.ITEM]})]}),e.jsx("div",{className:"kanban-board",children:O.map(t=>e.jsx(H,{status:t.status,title:t.title,tickets:(a==null?void 0:a.filter(g=>g.status===t.status))||[],onDrop:I,onEdit:E,onDelete:S},t.status))}),e.jsx(G,{isOpen:l,onClose:N,title:s?`Edit ${i.ITEM}`:`Create ${i.ITEM}`,children:e.jsx(Y,{ticket:s,onSubmit:U,onCancel:N,isLoading:d.isPending||n.isPending})}),e.jsx(k,{isOpen:y,onClose:()=>j(!1),onConfirm:$,title:`Update ${i.ITEM}`,message:`Are you sure you want to update this ${i.item}?`,confirmLabel:"Update"}),e.jsx(k,{isOpen:b,onClose:()=>h(!1),onConfirm:M,title:`Delete ${i.ITEM}`,message:`Are you sure you want to delete this ${i.item}?
This action cannot be undone.`,confirmLabel:"Delete",isDanger:!0})]})};export{ae as default};
