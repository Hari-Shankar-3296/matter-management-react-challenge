import{j as e}from"./vendor-query-30WTYxUa.js";import{h as T,r as h}from"./vendor-react-3BJtw-ek.js";import{b as Q,c as V,d as X,e as Z}from"./useTickets-l-PqA1f4.js";import{u as _}from"./useUsers-vdCakwpb.js";import{T as n}from"./index-qdssDWYQ.js";import{i as O,a as D,B as x,f as k,A as E,M as F,T as ee,C as M}from"./Badge-D2-mizKm.js";import"./queryKeys-D-dtdCA2.js";const se=({onFilterChange:s,initialFilters:t})=>{const[r,d]=T(),u=r.get("search")||(t==null?void 0:t.search)||"",c=r.get("status")||(t==null?void 0:t.status)||"",l=r.get("priority")||"",o=r.get("sortBy")||(t==null?void 0:t.sortBy)||"date",j=(i,p)=>{const m=new URLSearchParams(r);p?m.set(i,p):m.delete(i),d(m),s({search:i==="search"?p:u,status:i==="status"?p:c,priority:i==="priority"?p:l,sortBy:i==="sortBy"?p:o})};return e.jsxs("div",{className:"ticket-filters",children:[e.jsx("input",{type:"text",placeholder:`Search ${n.items}...`,value:u,onChange:i=>j("search",i.target.value)}),e.jsxs("select",{value:c,onChange:i=>j("status",i.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"closed",children:"Closed"})]}),e.jsxs("select",{value:l,onChange:i=>j("priority",i.target.value),children:[e.jsx("option",{value:"",children:"All Priority"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsxs("select",{value:o,onChange:i=>j("sortBy",i.target.value),children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"title",children:"Sort by Title"}),e.jsx("option",{value:"priority",children:"Sort by Priority"}),e.jsx("option",{value:"dueDate",children:"Sort by Due Date"})]})]})},te=({ticket:s,isSelected:t,onSelect:r,onEdit:d,onDelete:u})=>{const c=O(s.dueDate),l=D(s.dueDate);return e.jsxs("div",{className:`ticket-card ${t?"selected":""}`,onClick:()=>r(s),children:[e.jsxs("div",{className:"ticket-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flex:1,minWidth:0},children:[e.jsx("span",{className:"ticket-card-title",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.title}),c&&!l&&e.jsx(x,{type:"due",value:"Due this week"}),l&&e.jsx(x,{type:"due",value:"Overdue"})]}),e.jsxs("div",{className:"ticket-card-actions",children:[e.jsx("button",{className:"action-btn",onClick:o=>{o.stopPropagation(),d(s)},children:"âœï¸"}),e.jsx("button",{className:"action-btn delete",onClick:o=>{o.stopPropagation(),u(s.id)},children:"ðŸ—‘ï¸"})]})]}),e.jsx("div",{className:"ticket-card-meta",children:e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",position:"relative"},children:[e.jsx(x,{type:"status",value:s.status}),e.jsx(x,{type:"priority",value:s.priority}),e.jsx("span",{className:"ticket-card-date",children:k(s.createdAt)}),e.jsxs("div",{style:{position:"absolute",right:"8px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("p",{className:"ticket-card-date",children:"Assigned to "}),e.jsx("div",{onClick:o=>o.stopPropagation(),children:e.jsx(E,{ticketId:s.id,currentAssigneeId:s.assigneeId})})]})]})})]})},ae=({tickets:s,selectedId:t,onSelect:r,onEdit:d,onDelete:u})=>!s||s.length===0?e.jsxs("div",{className:"empty-state",children:["No ",n.items," found"]}):e.jsx("div",{className:"ticket-list",style:{maxHeight:"65vh",overflowY:"auto"},children:s.map(c=>e.jsx(te,{ticket:c,isSelected:t===c.id,onSelect:r,onEdit:d,onDelete:u},c.id))}),ie=({ticket:s,getUserName:t})=>s?e.jsxs("div",{className:"ticket-detail",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsx("h2",{children:s.title})}),e.jsxs("div",{className:"ticket-meta",children:[e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"ID"}),e.jsxs("span",{children:["#",s.id]})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Status"}),e.jsx(x,{type:"status",value:s.status})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Priority"}),e.jsx(x,{type:"priority",value:s.priority})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Reporter"}),e.jsx("span",{children:t(s.reporterId)})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Assignee"}),e.jsx(E,{ticketId:s.id,currentAssigneeId:s.assigneeId})]}),e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Created"}),e.jsx("span",{children:k(s.createdAt)})]}),s.dueDate&&e.jsxs("div",{className:"ticket-meta-item",children:[e.jsx("span",{className:"ticket-meta-label",children:"Due Date"}),e.jsxs("span",{children:[k(s.dueDate),O(s.dueDate)&&!D(s.dueDate)&&e.jsx(x,{type:"due",value:"Due this week"}),D(s.dueDate)&&e.jsx(x,{type:"due",value:"Overdue"})]})]})]}),e.jsxs("div",{className:"ticket-description",children:[e.jsx("h3",{children:"Description"}),e.jsx("p",{children:s.description||"No description provided."})]})]}):e.jsxs("div",{className:"ticket-detail-empty",children:["Select a ",n.item," to view details"]}),pe=()=>{const[s]=T(),[t,r]=h.useState({search:s.get("search")||void 0,status:s.get("status")||void 0,priority:s.get("priority")||void 0,sortBy:s.get("sortBy")||"date"}),[d,u]=h.useState(null),[c,l]=h.useState(!1),[o,j]=h.useState(!1),[i,p]=h.useState(null),[m,v]=h.useState(null),[A,f]=h.useState(!1),[C,S]=h.useState(null),[,b]=T();h.useEffect(()=>{const a={};t.search&&(a.search=t.search),t.status&&t.status!=="all"&&(a.status=t.status),t.priority&&t.priority!=="all"&&(a.priority=t.priority),t.sortBy&&(a.sortBy=t.sortBy),b(a,{replace:!0})},[t,b]);const{data:g,isLoading:B,error:U}=Q(t),{data:y}=_(),I=V(),$=X(),P=Z(),L=g==null?void 0:g.find(a=>a.id===d),R=a=>{if(!a)return"Unassigned";const N=y==null?void 0:y.find(K=>K.id===a);return N?`${N.firstName} ${N.lastName}`:"Unknown"},W=a=>{r(a)},H=()=>{v(null),l(!0)},Y=a=>{v(a),l(!0)},G=a=>{p(a),j(!0)},q=()=>{i&&($.mutate(i),d===i&&u(null),p(null))},z=a=>{m?(S(a),f(!0)):P.mutate(a,{onSuccess:()=>{l(!1)}})},J=()=>{m&&C&&I.mutate({id:m.id,...C},{onSuccess:()=>{l(!1),v(null),f(!1),S(null)}})},w=()=>{l(!1),v(null)};return B?e.jsxs("div",{className:"loading",children:["Loading ",n.items,"..."]}):U?e.jsxs("div",{className:"error-message",children:["Error loading ",n.items]}):e.jsxs("div",{className:"tickets-page",children:[e.jsxs("div",{className:"ticket-list-section",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:n.ITEMS}),e.jsxs("button",{className:"btn btn-primary",onClick:H,children:["+ Add ",n.ITEM]})]}),e.jsx(se,{onFilterChange:W,initialFilters:t}),e.jsx(ae,{tickets:g||[],selectedId:d,onSelect:a=>u(a.id),onEdit:Y,onDelete:G})]}),e.jsx("div",{className:"ticket-detail-section",children:e.jsx(ie,{ticket:L,getUserName:R})}),e.jsx(F,{isOpen:c,onClose:w,title:m?`Edit ${n.ITEM}`:`Create ${n.ITEM}`,children:e.jsx(ee,{ticket:m,onSubmit:z,onCancel:w,isLoading:I.isPending||P.isPending})}),e.jsx(M,{isOpen:A,onClose:()=>f(!1),onConfirm:J,title:`Update ${n.ITEM}`,message:`Are you sure you want to update this ${n.item}?`,confirmLabel:"Update"}),e.jsx(M,{isOpen:o,onClose:()=>j(!1),onConfirm:q,title:`Delete ${n.ITEM}`,message:`Are you sure you want to delete this ${n.item}?
This action cannot be undone.`,confirmLabel:"Delete",isDanger:!0})]})};export{pe as default};
